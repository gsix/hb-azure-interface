# HbAzureInterface
Приложение для синхронизации данных между dev.azure и hubstaff по наработанному времени

### Фишки
- Приём вебхуков о событиях по work items от dev.azure
- Передача данных hubstaff
- Опрашивание hubstaff и получение наработанного времени по каждой задаче
- Передача наработанного времени в dev.azure

### Зависимости
- PostgreSQL 9.5
- Ruby 2.6.1
- Rails 5.2.3

### Предварительная настройка
Необходимо [создать приложение](https://developer.hubstaff.com/apps) для авторизации на hubstaff.
В credentials записать ключи и redirect_url от созданного приложения.

# Usage

### Создание пользователя
В приложении отключена регистрация.
Юзера можно создать выполнив сиды, либо руками в консоли
```
User.create! email: "admin@mail.ru", password: "password"
```

### Создание организации
- azure id - id вашей организации в [dev.azure](https://dev.azure.com). Найдёте по url
- azure access token - документация по созданию [вот](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops)
- hubstaff id - id вашей организации в [hubstaff](https://hubstaff.com/). Найдёте по url
- Автоматически создавать ли хуки в Azure при создании проекта
- Автоматически создавать проект в Hubstaff

### Подключение огранизации к hubstaff
- На странице организации нажмите "Настроить доступ Hubstaff"
- Запросите код "Получить код"
- Авторизуйтесь в hubstaff
- Скопируйте полученный код
- Вставьте код в инпут на странице "Настроить доступ Hubstaff" и сохраните

### Настройка сотрудников
- На странице организации в разделе "Сотрудники" нажмите "Обновить"
- Подключите каждого сотрудника к hubstaff нажав edit в его странице. Список ссылок на сотрудников из hubstaff должен появится при редактировании

### Настройка проектов
- Когда вы создаёте проект в dev.azure, на странице организации в разделе "Проекты" нажмите "Обновить", проект будет добавлен в список
- Если у организации включены опции "создавать проект в хабстаф автоматически" и "создавать хуки автоматически", то редактировать проект не нужно
- Иначе:
- Подключите каждый проект к hubstaff нажав "Редактировать" в его странице. Список ссылок на проекты из hubstaff должен появится при редактировании
- Либо создайте проект в HB нажав на странице проекта "Создать проект в hubstaff"
- Создайте хуки нажав "Создать хуки в azure" на странице проекта, если хуки не были созданы


* [developer hubstaff docs v2](https://developer.hubstaff.com/docs/hubstaff_v2#/)